OPTION CASEMAP:NONE

include vec.inc
include dumpreg.inc

M_TRUNC EQU 9   ; Mantissa trancation length (in bits)

.data
TABLE SEGMENT ALIGN(32)
				; 1/a, log(a), TODO...
table	dq 1.0009765625, 0.0009760859730554589
				dq 1.0029296875, 0.002925404329105136
				dq 1.0048828125, 0.004870930234596512
				dq 1.0068359375, 0.006812678417506831
				dq 1.0087890625, 0.008750663520185453
				dq 1.0107421875, 0.010684900100016353
				dq 1.0126953125, 0.012615402630074235
				dq 1.0146484375, 0.0145421854997743
				dq 1.0166015625, 0.01646526301551579
				dq 1.0185546875, 0.018384649401319352
				dq 1.0205078125, 0.020300358799458285
				dq 1.0224609375, 0.02221240527108376
				dq 1.0244140625, 0.02412080279684408
				dq 1.0263671875, 0.026025565277498032
				dq 1.0283203125, 0.027926706534522408
				dq 1.0302734375, 0.029824240310713776
				dq 1.0322265625, 0.03171818027078454
				dq 1.0341796875, 0.03360854000195337
				dq 1.0361328125, 0.03549533301453004
				dq 1.0380859375, 0.037378572742494835
				dq 1.0400390625, 0.039258272544072395
				dq 1.0419921875, 0.04113444570230027
				dq 1.0439453125, 0.043007105425592135
				dq 1.0458984375, 0.044876264848295676
				dq 1.0478515625, 0.04674193703124538
				dq 1.0498046875, 0.04860413496231008
				dq 1.0517578125, 0.05046287155693547
				dq 1.0537109375, 0.052318159658681564
				dq 1.0556640625, 0.05417001203975518
				dq 1.0576171875, 0.056018441401537514
				dq 1.0595703125, 0.05786346037510683
				dq 1.0615234375, 0.05970508152175635
				dq 1.0634765625, 0.061543317333507375
				dq 1.0654296875, 0.06337818023361773
				dq 1.0673828125, 0.06520968257708547
				dq 1.0693359375, 0.0670378366511481
				dq 1.0712890625, 0.06886265467577715
				dq 1.0732421875, 0.07068414880416826
				dq 1.0751953125, 0.07250233112322686
				dq 1.0771484375, 0.07431721365404938
				dq 1.0791015625, 0.0761288083524001
				dq 1.0810546875, 0.07793712710918378
				dq 1.0830078125, 0.07974218175091394
				dq 1.0849609375, 0.0815439840401769
				dq 1.0869140625, 0.08334254567609174
				dq 1.0888671875, 0.08513787829476605
				dq 1.0908203125, 0.08692999346974761
				dq 1.0927734375, 0.08871890271247214
				dq 1.0947265625, 0.09050461747270681
				dq 1.0966796875, 0.09228714913899008
				dq 1.0986328125, 0.09406650903906741
				dq 1.1005859375, 0.09584270844032321
				dq 1.1025390625, 0.09761575855020892
				dq 1.1044921875, 0.09938567051666736
				dq 1.1064453125, 0.10115245542855322
				dq 1.1083984375, 0.10291612431604996
				dq 1.1103515625, 0.10467668815108294
				dq 1.1123046875, 0.10643415784772904
				dq 1.1142578125, 0.10818854426262255
				dq 1.1162109375, 0.10993985819535756
				dq 1.1181640625, 0.11168811038888693
				dq 1.1201171875, 0.11343331152991759
				dq 1.1220703125, 0.1151754722493026
				dq 1.1240234375, 0.11691460312242954
				dq 1.1259765625, 0.11865071466960593
				dq 1.1279296875, 0.12038381735644083
				dq 1.1298828125, 0.12211392159422348
				dq 1.1318359375, 0.12384103774029862
				dq 1.1337890625, 0.1255651760984384
				dq 1.1357421875, 0.12728634691921134
				dq 1.1376953125, 0.12900456040034786
				dq 1.1396484375, 0.13071982668710289
				dq 1.1416015625, 0.1324321558726153
				dq 1.1435546875, 0.13414155799826424
				dq 1.1455078125, 0.13584804305402237
				dq 1.1474609375, 0.13755162097880624
				dq 1.1494140625, 0.1392523016608236
				dq 1.1513671875, 0.14095009493791782
				dq 1.1533203125, 0.1426450105979092
				dq 1.1552734375, 0.14433705837893368
				dq 1.1572265625, 0.14602624796977848
				dq 1.1591796875, 0.14771258901021495
				dq 1.1611328125, 0.14939609109132873
				dq 1.1630859375, 0.151076763755847
				dq 1.1650390625, 0.15275461649846303
				dq 1.1669921875, 0.15442965876615794
				dq 1.1689453125, 0.15610189995852006
				dq 1.1708984375, 0.15777134942806115
				dq 1.1728515625, 0.15943801648053044
				dq 1.1748046875, 0.16110191037522578
				dq 1.1767578125, 0.16276304032530228
				dq 1.1787109375, 0.1644214154980784
				dq 1.1806640625, 0.16607704501533957
				dq 1.1826171875, 0.16772993795363916
				dq 1.1845703125, 0.16938010334459705
				dq 1.1865234375, 0.17102755017519575
				dq 1.1884765625, 0.17267228738807408
				dq 1.1904296875, 0.17431432388181842
				dq 1.1923828125, 0.17595366851125158
				dq 1.1943359375, 0.17759033008771927
				dq 1.1962890625, 0.17922431737937428
				dq 1.1982421875, 0.18085563911145836
				dq 1.2001953125, 0.18248430396658172
				dq 1.2021484375, 0.1841103205850004
				dq 1.2041015625, 0.1857336975648912
				dq 1.2060546875, 0.18735444346262448
				dq 1.2080078125, 0.1889725667930348
				dq 1.2099609375, 0.19058807602968936
				dq 1.2119140625, 0.19220097960515412
				dq 1.2138671875, 0.193811285911258
				dq 1.2158203125, 0.19541900329935488
				dq 1.2177734375, 0.19702414008058336
				dq 1.2197265625, 0.19862670452612458
				dq 1.2216796875, 0.20022670486745806
				dq 1.2236328125, 0.2018241492966152
				dq 1.2255859375, 0.20341904596643118
				dq 1.2275390625, 0.20501140299079432
				dq 1.2294921875, 0.20660122844489406
				dq 1.2314453125, 0.20818853036546647
				dq 1.2333984375, 0.20977331675103802
				dq 1.2353515625, 0.21135559556216751
				dq 1.2373046875, 0.21293537472168597
				dq 1.2392578125, 0.21451266211493455
				dq 1.2412109375, 0.21608746559000094
				dq 1.2431640625, 0.21765979295795343
				dq 1.2451171875, 0.21922965199307343
				dq 1.2470703125, 0.2207970504330862
				dq 1.2490234375, 0.2223619959793896
				dq 1.2509765625, 0.22392449629728114
				dq 1.2529296875, 0.22548455901618333
				dq 1.2548828125, 0.2270421917298671
				dq 1.2568359375, 0.22859740199667358
				dq 1.2587890625, 0.2301501973397343
				dq 1.2607421875, 0.2317005852471894
				dq 1.2626953125, 0.23324857317240438
				dq 1.2646484375, 0.23479416853418503
				dq 1.2666015625, 0.2363373787169908
				dq 1.2685546875, 0.23787821107114646
				dq 1.2705078125, 0.2394166729130522
				dq 1.2724609375, 0.24095277152539202
				dq 1.2744140625, 0.24248651415734068
				dq 1.2763671875, 0.24401790802476886
				dq 1.2783203125, 0.24554696031044684
				dq 1.2802734375, 0.24707367816424675
				dq 1.2822265625, 0.24859806870334308
				dq 1.2841796875, 0.2501201390124118
				dq 1.2861328125, 0.2516398961438279
				dq 1.2880859375, 0.25315734711786153
				dq 1.2900390625, 0.25467249892287225
				dq 1.2919921875, 0.2561853585155026
				dq 1.2939453125, 0.2576959328208695
				dq 1.2958984375, 0.2592042287327544
				dq 1.2978515625, 0.26071025311379226
				dq 1.2998046875, 0.26221401279565854
				dq 1.3017578125, 0.26371551457925557
				dq 1.3037109375, 0.2652147652348968
				dq 1.3056640625, 0.2667117715024901
				dq 1.3076171875, 0.2682065400917194
				dq 1.3095703125, 0.26969907768222545
				dq 1.3115234375, 0.27118939092378447
				dq 1.3134765625, 0.27267748643648637
				dq 1.3154296875, 0.2741633708109109
				dq 1.3173828125, 0.2756470506083028
				dq 1.3193359375, 0.27712853236074575
				dq 1.3212890625, 0.27860782257133493
				dq 1.3232421875, 0.2800849277143482
				dq 1.3251953125, 0.2815598542354161
				dq 1.3271484375, 0.2830326085516906
				dq 1.3291015625, 0.284503197052013
				dq 1.3310546875, 0.28597162609707955
				dq 1.3330078125, 0.287437902019607
				dq 1.3349609375, 0.2889020311244965
				dq 1.3369140625, 0.2903640196889958
				dq 1.3388671875, 0.2918238739628613
				dq 1.3408203125, 0.29328160016851795
				dq 1.3427734375, 0.2947372045012186
				dq 1.3447265625, 0.29619069312920177
				dq 1.3466796875, 0.2976420721938487
				dq 1.3486328125, 0.29909134780983904
				dq 1.3505859375, 0.3005385260653051
				dq 1.3525390625, 0.3019836130219858
				dq 1.3544921875, 0.3034266147153785
				dq 1.3564453125, 0.3048675371548907
				dq 1.3583984375, 0.3063063863239898
				dq 1.3603515625, 0.30774316818035263
				dq 1.3623046875, 0.3091778886560129
				dq 1.3642578125, 0.3106105536575087
				dq 1.3662109375, 0.3120411690660281
				dq 1.3681640625, 0.3134697407375539
				dq 1.3701171875, 0.31489627450300783
				dq 1.3720703125, 0.31632077616839305
				dq 1.3740234375, 0.317743251514936
				dq 1.3759765625, 0.31916370629922713
				dq 1.3779296875, 0.3205821462533609
				dq 1.3798828125, 0.32199857708507434
				dq 1.3818359375, 0.3234130044778849
				dq 1.3837890625, 0.3248254340912273
				dq 1.3857421875, 0.3262358715605896
				dq 1.3876953125, 0.3276443224976475
				dq 1.3896484375, 0.32905079249039926
				dq 1.3916015625, 0.3304552871032978
				dq 1.3935546875, 0.33185781187738334
				dq 1.3955078125, 0.33325837233041433
				dq 1.3974609375, 0.33465697395699784
				dq 1.3994140625, 0.33605362222871876
				dq 1.4013671875, 0.3374483225942684
				dq 1.4033203125, 0.33884108047957184
				dq 1.4052734375, 0.3402319012879147
				dq 1.4072265625, 0.341620790400069
				dq 1.4091796875, 0.3430077531744178
				dq 1.4111328125, 0.3443927949470794
				dq 1.4130859375, 0.34577592103203075
				dq 1.4150390625, 0.3471571367212293
				dq 1.4169921875, 0.34853644728473476
				dq 1.4189453125, 0.3499138579708298
				dq 1.4208984375, 0.3512893740061398
				dq 1.4228515625, 0.35266300059575173
				dq 1.4248046875, 0.35403474292333253
				dq 1.4267578125, 0.35540460615124636
				dq 1.4287109375, 0.3567725954206712
				dq 1.4306640625, 0.3581387158517146
				dq 1.4326171875, 0.35950297254352864
				dq 1.4345703125, 0.3608653705744242
				dq 1.4365234375, 0.3622259150019844
				dq 1.4384765625, 0.36358461086317717
				dq 1.4404296875, 0.36494146317446713
				dq 1.4423828125, 0.3662964769319267
				dq 1.4443359375, 0.36764965711134673
				dq 1.4462890625, 0.3690010086683457
				dq 1.4482421875, 0.370350536538479
				dq 1.4501953125, 0.3716982456373469
				dq 1.4521484375, 0.373044140860702
				dq 1.4541015625, 0.3743882270845559
				dq 1.4560546875, 0.37573050916528533
				dq 1.4580078125, 0.3770709919397373
				dq 1.4599609375, 0.3784096802253337
				dq 1.4619140625, 0.37974657882017526
				dq 1.4638671875, 0.3810816925031446
				dq 1.4658203125, 0.38241502603400884
				dq 1.4677734375, 0.3837465841535214
				dq 1.4697265625, 0.38507637158352304
				dq 1.4716796875, 0.3864043930270424
				dq 1.4736328125, 0.3877306531683958
				dq 1.4755859375, 0.3890551566732865
				dq 1.4775390625, 0.39037790818890283
				dq 1.4794921875, 0.39169891234401644
				dq 1.4814453125, 0.39301817374907916
				dq 1.4833984375, 0.39433569699631976
				dq 1.4853515625, 0.39565148665983974
				dq 1.4873046875, 0.3969655472957087
				dq 1.4892578125, 0.3982778834420589
				dq 1.4912109375, 0.39958849961917936
				dq 1.4931640625, 0.4008974003296092
				dq 1.4951171875, 0.40220459005823067
				dq 1.4970703125, 0.40351007327236105
				dq 1.4990234375, 0.4048138544218444
				dq 1.5009765625, 0.40611593793914275
				dq 1.5029296875, 0.40741632823942614
				dq 1.5048828125, 0.40871502972066265
				dq 1.5068359375, 0.4100120467637077
				dq 1.5087890625, 0.41130738373239273
				dq 1.5107421875, 0.41260104497361305
				dq 1.5126953125, 0.4138930348174155
				dq 1.5146484375, 0.41518335757708574
				dq 1.5166015625, 0.41647201754923396
				dq 1.5185546875, 0.4177590190138814
				dq 1.5205078125, 0.4190443662345452
				dq 1.5224609375, 0.4203280634583234
				dq 1.5244140625, 0.421610114915979
				dq 1.5263671875, 0.4228905248220235
				dq 1.5283203125, 0.4241692973748005
				dq 1.5302734375, 0.42544643675656774
				dq 1.5322265625, 0.42672194713357947
				dq 1.5341796875, 0.4279958326561681
				dq 1.5361328125, 0.4292680974588247
				dq 1.5380859375, 0.43053874566028033
				dq 1.5400390625, 0.4318077813635853
				dq 1.5419921875, 0.433075208656189
				dq 1.5439453125, 0.4343410316100189
				dq 1.5458984375, 0.43560525428155905
				dq 1.5478515625, 0.4368678807119279
				dq 1.5498046875, 0.438128914926956
				dq 1.5517578125, 0.4393883609372629
				dq 1.5537109375, 0.44064622273833376
				dq 1.5556640625, 0.4419025043105954
				dq 1.5576171875, 0.44315720961949184
				dq 1.5595703125, 0.44441034261555934
				dq 1.5615234375, 0.44566190723450116
				dq 1.5634765625, 0.4469119073972616
				dq 1.5654296875, 0.4481603470100999
				dq 1.5673828125, 0.44940722996466315
				dq 1.5693359375, 0.4506525601380595
				dq 1.5712890625, 0.4518963413929301
				dq 1.5732421875, 0.4531385775775213
				dq 1.5751953125, 0.4543792725257558
				dq 1.5771484375, 0.45561843005730385
				dq 1.5791015625, 0.4568560539776538
				dq 1.5810546875, 0.45809214807818205
				dq 1.5830078125, 0.459326716136223
				dq 1.5849609375, 0.46055976191513814
				dq 1.5869140625, 0.4617912891643848
				dq 1.5888671875, 0.4630213016195847
				dq 1.5908203125, 0.46424980300259205
				dq 1.5927734375, 0.46547679702156075
				dq 1.5947265625, 0.466702287371012
				dq 1.5966796875, 0.46792627773190065
				dq 1.5986328125, 0.4691487717716818
				dq 1.6005859375, 0.4703697731443766
				dq 1.6025390625, 0.4715892854906378
				dq 1.6044921875, 0.472807312437815
				dq 1.6064453125, 0.4740238576000192
				dq 1.6083984375, 0.4752389245781872
				dq 1.6103515625, 0.4764525169601458
				dq 1.6123046875, 0.4776646383206749
				dq 1.6142578125, 0.4788752922215711
				dq 1.6162109375, 0.4800844822117102
				dq 1.6181640625, 0.4812922118271098
				dq 1.6201171875, 0.48249848459099137
				dq 1.6220703125, 0.48370330401384176
				dq 1.6240234375, 0.48490667359347456
				dq 1.6259765625, 0.4861085968150911
				dq 1.6279296875, 0.4873090771513409
				dq 1.6298828125, 0.488508118062382
				dq 1.6318359375, 0.4897057229959406
				dq 1.6337890625, 0.4909018953873709
				dq 1.6357421875, 0.4920966386597137
				dq 1.6376953125, 0.49328995622375577
				dq 1.6396484375, 0.4944818514780877
				dq 1.6416015625, 0.49567232780916254
				dq 1.6435546875, 0.4968613885913529
				dq 1.6455078125, 0.498049037187009
				dq 1.6474609375, 0.4992352769465152
				dq 1.6494140625, 0.500420111208347
				dq 1.6513671875, 0.5016035432991272
				dq 1.6533203125, 0.5027855765336822
				dq 1.6552734375, 0.5039662142150976
				dq 1.6572265625, 0.5051454596347732
				dq 1.6591796875, 0.5063233160724789
				dq 1.6611328125, 0.5074997867964086
				dq 1.6630859375, 0.5086748750632352
				dq 1.6650390625, 0.509848584118164
				dq 1.6669921875, 0.5110209171949875
				dq 1.6689453125, 0.5121918775161378
				dq 1.6708984375, 0.5133614682927404
				dq 1.6728515625, 0.5145296927246669
				dq 1.6748046875, 0.5156965540005872
				dq 1.6767578125, 0.5168620552980224
				dq 1.6787109375, 0.5180261997833961
				dq 1.6806640625, 0.5191889906120863
				dq 1.6826171875, 0.5203504309284765
				dq 1.6845703125, 0.521510523866007
				dq 1.6865234375, 0.5226692725472255
				dq 1.6884765625, 0.5238266800838374
				dq 1.6904296875, 0.5249827495767562
				dq 1.6923828125, 0.526137484116153
				dq 1.6943359375, 0.5272908867815065
				dq 1.6962890625, 0.5284429606416519
				dq 1.6982421875, 0.5295937087548299
				dq 1.7001953125, 0.530743134168736
				dq 1.7021484375, 0.5318912399205679
				dq 1.7041015625, 0.5330380290370744
				dq 1.7060546875, 0.5341835045346035
				dq 1.7080078125, 0.535327669419149
				dq 1.7099609375, 0.5364705266863987
				dq 1.7119140625, 0.5376120793217815
				dq 1.7138671875, 0.5387523303005131
				dq 1.7158203125, 0.5398912825876441
				dq 1.7177734375, 0.5410289391381051
				dq 1.7197265625, 0.542165302896753
				dq 1.7216796875, 0.5433003767984171
				dq 1.7236328125, 0.5444341637679441
				dq 1.7255859375, 0.5455666667202433
				dq 1.7275390625, 0.5466978885603322
				dq 1.7294921875, 0.5478278321833805
				dq 1.7314453125, 0.5489565004747547
				dq 1.7333984375, 0.550083896310063
				dq 1.7353515625, 0.5512100225551982
				dq 1.7373046875, 0.552334882066382
				dq 1.7392578125, 0.5534584776902085
				dq 1.7412109375, 0.5545808122636873
				dq 1.7431640625, 0.5557018886142864
				dq 1.7451171875, 0.5568217095599749
				dq 1.7470703125, 0.557940277909266
				dq 1.7490234375, 0.5590575964612586
				dq 1.7509765625, 0.5601736680056798
				dq 1.7529296875, 0.5612884953229261
				dq 1.7548828125, 0.562402081184106
				dq 1.7568359375, 0.56351442835108
				dq 1.7587890625, 0.564625539576503
				dq 1.7607421875, 0.5657354176038641
				dq 1.7626953125, 0.5668440651675282
				dq 1.7646484375, 0.5679514849927754
				dq 1.7666015625, 0.569057679795842
				dq 1.7685546875, 0.5701626522839602
				dq 1.7705078125, 0.571266405155398
				dq 1.7724609375, 0.5723689410994981
				dq 1.7744140625, 0.5734702627967181
				dq 1.7763671875, 0.5745703729186692
				dq 1.7783203125, 0.5756692741281548
				dq 1.7802734375, 0.57676696907921
				dq 1.7822265625, 0.5778634604171388
				dq 1.7841796875, 0.5789587507785536
				dq 1.7861328125, 0.5800528427914126
				dq 1.7880859375, 0.5811457390750576
				dq 1.7900390625, 0.5822374422402519
				dq 1.7919921875, 0.5833279548892175
				dq 1.7939453125, 0.5844172796156726
				dq 1.7958984375, 0.585505419004868
				dq 1.7978515625, 0.5865923756336248
				dq 1.7998046875, 0.5876781520703702
				dq 1.8017578125, 0.5887627508751745
				dq 1.8037109375, 0.5898461745997868
				dq 1.8056640625, 0.5909284257876718
				dq 1.8076171875, 0.5920095069740444
				dq 1.8095703125, 0.5930894206859066
				dq 1.8115234375, 0.5941681694420824
				dq 1.8134765625, 0.5952457557532527
				dq 1.8154296875, 0.596322182121991
				dq 1.8173828125, 0.5973974510427976
				dq 1.8193359375, 0.5984715650021354
				dq 1.8212890625, 0.5995445264784628
				dq 1.8232421875, 0.6006163379422695
				dq 1.8251953125, 0.6016870018561098
				dq 1.8271484375, 0.6027565206746365
				dq 1.8291015625, 0.6038248968446355
				dq 1.8310546875, 0.604892132805058
				dq 1.8330078125, 0.6059582309870557
				dq 1.8349609375, 0.6070231938140123
				dq 1.8369140625, 0.6080870237015773
				dq 1.8388671875, 0.6091497230576993
				dq 1.8408203125, 0.6102112942826581
				dq 1.8427734375, 0.6112717397690971
				dq 1.8447265625, 0.6123310619020564
				dq 1.8466796875, 0.6133892630590044
				dq 1.8486328125, 0.6144463456098698
				dq 1.8505859375, 0.6155023119170736
				dq 1.8525390625, 0.6165571643355611
				dq 1.8544921875, 0.6176109052128328
				dq 1.8564453125, 0.618663536888976
				dq 1.8583984375, 0.6197150616966964
				dq 1.8603515625, 0.6207654819613483
				dq 1.8623046875, 0.621814800000966
				dq 1.8642578125, 0.6228630181262945
				dq 1.8662109375, 0.6239101386408199
				dq 1.8681640625, 0.6249561638407998
				dq 1.8701171875, 0.6260010960152933
				dq 1.8720703125, 0.6270449374461914
				dq 1.8740234375, 0.6280876904082469
				dq 1.8759765625, 0.6291293571691036
				dq 1.8779296875, 0.6301699399893267
				dq 1.8798828125, 0.6312094411224315
				dq 1.8818359375, 0.6322478628149133
				dq 1.8837890625, 0.633285207306276
				dq 1.8857421875, 0.6343214768290614
				dq 1.8876953125, 0.6353566736088778
				dq 1.8896484375, 0.636390799864429
				dq 1.8916015625, 0.6374238578075427
				dq 1.8935546875, 0.6384558496431987
				dq 1.8955078125, 0.6394867775695572
				dq 1.8974609375, 0.640516643777987
				dq 1.8994140625, 0.6415454504530935
				dq 1.9013671875, 0.6425731997727466
				dq 1.9033203125, 0.6435998939081077
				dq 1.9052734375, 0.6446255350236582
				dq 1.9072265625, 0.6456501252772259
				dq 1.9091796875, 0.646673666820013
				dq 1.9111328125, 0.6476961617966231
				dq 1.9130859375, 0.6487176123450876
				dq 1.9150390625, 0.6497380205968932
				dq 1.9169921875, 0.6507573886770079
				dq 1.9189453125, 0.6517757187039085
				dq 1.9208984375, 0.652793012789606
				dq 1.9228515625, 0.6538092730396724
				dq 1.9248046875, 0.6548245015532671
				dq 1.9267578125, 0.6558387004231623
				dq 1.9287109375, 0.6568518717357692
				dq 1.9306640625, 0.6578640175711639
				dq 1.9326171875, 0.6588751400031126
				dq 1.9345703125, 0.6598852410990979
				dq 1.9365234375, 0.6608943229203429
				dq 1.9384765625, 0.6619023875218377
				dq 1.9404296875, 0.6629094369523637
				dq 1.9423828125, 0.663915473254519
				dq 1.9443359375, 0.6649204984647432
				dq 1.9462890625, 0.6659245146133417
				dq 1.9482421875, 0.6669275237245107
				dq 1.9501953125, 0.6679295278163622
				dq 1.9521484375, 0.668930528900947
				dq 1.9541015625, 0.6699305289842803
				dq 1.9560546875, 0.6709295300663651
				dq 1.9580078125, 0.6719275341412164
				dq 1.9599609375, 0.672924543196885
				dq 1.9619140625, 0.6739205592154813
				dq 1.9638671875, 0.674915584173199
				dq 1.9658203125, 0.6759096200403384
				dq 1.9677734375, 0.6769026687813302
				dq 1.9697265625, 0.6778947323547587
				dq 1.9716796875, 0.6788858127133844
				dq 1.9736328125, 0.679875911804168
				dq 1.9755859375, 0.6808650315682924
				dq 1.9775390625, 0.6818531739411864
				dq 1.9794921875, 0.682840340852547
				dq 1.9814453125, 0.6838265342263616
				dq 1.9833984375, 0.6848117559809316
				dq 1.9853515625, 0.6857960080288935
				dq 1.9873046875, 0.6867792922772422
				dq 1.9892578125, 0.6877616106273527
				dq 1.9912109375, 0.6887429649750021
				dq 1.9931640625, 0.6897233572103917
				dq 1.9951171875, 0.690702789218169
				dq 1.9970703125, 0.691681262877449
				dq 1.9990234375, 0.6926587800618365
TABLE ENDS

.code
; @param (xmm0) - double w in [0, 1)
; @return (xmm0)
PUBLIC ln
ln PROC
	; Assume ymm0[i] \in [1,2) -> xmm0 = 0|000 0000 0000|mmmm mmmm mmmm ...
	;                           sign bit ^|^^ exponent ^|^^ mantissa ^^ ...
	vmovq rax, xmm0
	shr rax, 52 - M_TRUNC  ; most significant bits of mantissa -> index in table
	shl rax, 6  ; mul 64 (2 * sizeof ymmword ptr)
	lea rcx, table
	vmovapd ymm1, [rcx + rax]  ; [1/a, ln(a), c_5, c_4]

	; xmm2: calculate residual, r = x/a - 1.0
	mov rax, 0BFF0000000000000h  ; -1.0
	vmovq xmm2, rax
	vfmadd231sd xmm2, xmm0, xmm1  ; x*(1/a) + (-1.0)
	
	; xmm0: ln(a)
	_vpermj ymm0, ymm1  ; [ln(a), 1/a, c_5, c_4]

	; xmm3: P(r) ~= ln(1 + r);
	;	Horner's method: degree 5 minimax polynomia
	_vpermk ymm3, ymm0  ; [c_5, c_4, ln(a), 1/a]
	_vpermj ymm1, ymm3  ; [c_4, c_5, ln(a), 1/a]
	vfmadd132sd xmm3, xmm1, xmm2  ; c_5 * r + c_4 -> xmm4
	vmovapd ymm1, [rcx + rax + 32]  ; [c_3, c_2, c_1, c_0]
	vfmadd132sd xmm3, xmm1, xmm2  ; xmm4 * r + c_3 -> xmm4
	_vpermj ymm1, ymm1  ; [c_2, c_3, c_1, c_0]
	vfmadd132sd xmm3, xmm1, xmm2  ; xmm4 * r + c_2 -> xmm4
	_vpermk ymm1, ymm1  ; [c_1, c_0, c_2, c_3]
	vfmadd132sd xmm3, xmm1, xmm2  ; xmm4 * r + c_1 -> xmm4
	_vpermj ymm1, ymm1  ; [c_0, c_1, c_2, c_3]
	vfmadd132sd xmm3, xmm1, xmm2  ; xmm4 * r + c_0 -> xmm4

	; return ln(a) + P(r) ~= ln(x)
	vaddsd xmm0, xmm0, xmm3
	ret
ln ENDP
END
