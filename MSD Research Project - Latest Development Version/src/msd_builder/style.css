/* @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Sometype+Mono:ital,wght@0,400..700;1,400..700&display=swap'); */
@import url("fonts.css");

:root {
	--header-height: 3.4em;
	--timeline-height: 5rem;
	--params-form-width: 683px;
	--brand-color: white;
	--global-input-width: 24%;
}

/* ---- General Styles ----------------------------------------------------- */
body {
	max-width: 100vw;
	max-height: 100vh;
	overflow: hidden;
	margin: 0;
	
	font-family: "Sometype Mono", monospace;
}

h1, h2, h3, h4, h5, h6 {
	margin: 0;
	font-weight: bold;
	font-family: "Open Sans", sans-serif;
}

select, input, button {
	font: inherit;
}

.sideways {
	writing-mode: vertical-lr;
	transform: rotate(180deg);
}

.hide {
	display: none;
}


/* ---- Header ------------------------------------------------------------- */
body > header {
	--header-padding: 0.6rem;

	display: flex;
	justify-content: space-between;
	box-sizing: border-box;
	height: var(--header-height);
	padding: var(--header-padding);

	background-color: black;
	color: white;
}

body > header h1 {
	font-size: 1.1rem;
	margin: calc(0.9rem - var(--header-padding));
	color: var(--brand-color);
}

body > header svg {
	--logo-dim: calc(var(--header-height) - 2 * var(--header-padding));

	width: var(--logo-dim);
	height: var(--logo-dim);
	object-fit: contain;
	cursor: pointer;

	transition: transform 1s;
	transform: rotate(0deg);
}

body.show-settings > header svg {
	transform: rotate(360deg);
}

body > header svg > * {
	fill: var(--brand-color);
	stroke: var(--brand-color);
}

/* ---- Canvas (Three.js) -------------------------------------------------- */
#msd-3d {
	width: 100%;
	height: calc(100vh - var(--header-height));
	background-color: #1c1a1a;
}

#msd-3d canvas {
	width: inherit;
	height: inherit;
	object-fit: contain;
	object-position: center;
	transition: object-position 1s;
}

body.show-params-form #msd-3d canvas {
	object-position: right;
}

body.show-timeline #msd-3d canvas {
	object-position: top;
}

body.show-params-form.show-timeline #msd-3d canvas {
	object-position: right top;
}


/* ---- Parameters Form ---------------------------------------------------- */
#msd-params-form {
	position: absolute;
	z-index: 2;
	top: var(--header-height);
	bottom: 0;
	left: 0;
	width: var(--params-form-width);
	resize: horizontal;
	overflow: hidden;
	min-width: 10rem;  /* TODO: change to fit content */
	max-width: 100vw;
	/* TODO: add snap to default? */
	
	display: flex;
	flex-direction: column;

	background-color: white;

	transition: transform 1s, bottom 1s;
	transform: translateX(-100%);
}

body.show-params-form #msd-params-form {
	transform: translateX(0);
}

body.show-timeline #msd-params-form {
	bottom: var(--timeline-height);
}

#msd-params-form nav {
	border-bottom: 3px double black;
}

#msd-params-form nav > * {
	display: flex;
	justify-content: center;
	margin: 1em;
	gap: 1em;
}

#workspaces {
	width: 100%;
	border: 0px hidden;
	padding: 0.25em 0.5em;
	
	background-color: #f7f7f7;
	outline: 2px solid #e6e6e6;
	font-weight: bold;
}

#msd-params-form h2 {
	font-size: inherit;
	padding-block-end: 0.15em;  /* lines up baseline since we are using a different font face */
}


/* ---- Parameters Table --------------------------------------------------- */
#msd-params-table {
	position: relative;  /* Used for JS posistion offset calculation. [See: scrollTo() in form.js] */
	flex-grow: 1;
	overflow: auto;
}

#msd-params-table header {
	position: sticky;
	background-color: white;
	z-index: 1;
	text-align: center;
	font-size: 0.9em;
}

#msd-params-table > *  {
	display: grid;
	grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
	min-width: 40rem;
	/* margin: 1em 0em; */
	/* gap: 1px; */
}

#msd-params-table > .global > :not(:first-child) {
	grid-column: 2 / -1;
}

#msd-params-table > * > * {
	outline: 1px solid #e6e6e6;
}

#msd-params-table > header > *,
#msd-params-table > * > header {
	display: flex;
	flex-direction: column;
	justify-content: center;
}

#msd-params-table > header {
	top: 0;
	z-index: 2; /* On top of vertical row headers which have z-index: 1 */
	box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.27);
	background-color: white;
}

#msd-params-table > header > :first-child {
	position: sticky;
	left: 0;
	z-index: 3; /* On top of both vertical row headers (z-index: 1) AND horizontal column headers (z-index: 2) */
	background-color: white;
}

#msd-params-table > header > * {
	padding-block: 0.5em;
}

#msd-params-table section > :first-child {
	left: 0;
}

#msd-params-table > * > :first-child {
	width: 7.5em;
	padding-inline: 1.5rem;
}

#msd-params-table input,
#msd-params-table button,
#msd-params-table select {
	border: 2px solid;
	border-radius: 0.5em;
	box-sizing: border-box;
	padding: 0.25em;
}

#msd-params-table input,
#msd-params-table select {
	display: block;
	width: 80%;
	margin: 0.5em;
	text-align: right;
	border-color: black;
}

#msd-params-table input:focus,
#msd-params-table input.focus,  /* synced (faux) focus */
#msd-params-table select:focus {
	outline: none;
	background-color: rgba(0, 0, 0, 0.0875);
}

#msd-params-table section:not(.vector) input:not(.set):not(.focus),
#msd-params-table section.vector > div:not(:first-child):not(.set),
#msd-params-table section.vector > div:not(:first-child).set input:not(.set) {
	opacity: 0.375;
}

#msd-params-table .global input,
#msd-params-table .global select {
	width: var(--global-input-width);
}

#msd-params-table > section:not(.global) > div:nth-child(2) input,
#msd-params-table > section:not(.global) > div:nth-child(2) select {
	border-color: lightskyblue;
}

#msd-params-table > section:not(.global) > div:nth-child(2) input:focus,
#msd-params-table > section:not(.global) > div:nth-child(2) input.focus,  /* synced (faux) focus */
#msd-params-table > section:not(.global) > div:nth-child(2) select:focus {
	background-color: rgba(135, 206, 250, 0.25);
}

#msd-params-table > section:not(.global) > div:nth-child(3) input,
#msd-params-table > section:not(.global) > div:nth-child(3) select {
	border-color: forestgreen;
}

#msd-params-table > section:not(.global) > div:nth-child(3) input:focus,
#msd-params-table > section:not(.global) > div:nth-child(3) input.focus,  /* synced (faux) focus */
#msd-params-table > section:not(.global) > div:nth-child(3) select:focus {
	background-color: rgba(34, 139, 34, 0.125);
}

#msd-params-table > section:not(.global) > div:nth-child(4) input,
#msd-params-table > section:not(.global) > div:nth-child(4) select {
	border-color: crimson;
}

#msd-params-table > section:not(.global) > div:nth-child(4) input:focus,
#msd-params-table > section:not(.global) > div:nth-child(4) input.focus,  /* synced (faux) focus */
#msd-params-table > section:not(.global) > div:nth-child(4) select:focus {
	background-color: rgba(220, 20, 60, 0.125);
}

.vector > * {
	line-height: 1em;
}

.vector > :first-child {
	position: relative;
}

.vector .coordinate-labels {
	position: absolute;
	right: 0.5em;
	top: 0;
	bottom: 0;

	/* align labels with number fields */
	display: flex;
	flex-direction: column;
	justify-content: space-evenly;
	margin-block: -0.5em;
	overflow-y: hidden;

	color: #bbbbbb;
	font-size: 0.75rem;
	font-weight: bold;
}

.vector > :not(:first-child):not(:empty) {
	/* Column vector brackets as SVG background image. */
	background-image:
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='black' stroke-width='4' d='M39,11 Q11,11,11,39 V261 Q11,289,39,289' /></svg>"),
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='black' stroke-width='4' d='M11,11 Q39,11,39,39 V261 Q39,289,11,289' /></svg>");
	background-size: contain, contain;
	background-position: left, right;
	background-repeat: no-repeat;
	/* Scaling of SVG backgrounds: https://developer.mozilla.org/en-US/docs/Web/CSS/Scaling_of_SVG_backgrounds */
	/* preserveAspectRatio: https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/preserveAspectRatio */
	/* (SVG) Paths: https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths */
}

.vector:not(.global) > :nth-child(2):not(:empty) {
	background-image:
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='lightskyblue' stroke-width='4' d='M39,11 Q11,11,11,39 V261 Q11,289,39,289' /></svg>"),
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='lightskyblue' stroke-width='4' d='M11,11 Q39,11,39,39 V261 Q39,289,11,289' /></svg>");
}

.vector:not(.global) > :nth-child(3):not(:empty) {
	background-image:
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='forestgreen' stroke-width='4' d='M39,11 Q11,11,11,39 V261 Q11,289,39,289' /></svg>"),
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='forestgreen' stroke-width='4' d='M11,11 Q39,11,39,39 V261 Q39,289,11,289' /></svg>");
}

.vector:not(.global) > :nth-child(4):not(:empty) {
	background-image:
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='crimson' stroke-width='4' d='M39,11 Q11,11,11,39 V261 Q11,289,39,289' /></svg>"),
		url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 50 300' width='50' height='300' preserveAspectRatio='none'><path fill='transparent' stroke='crimson' stroke-width='4' d='M11,11 Q39,11,39,39 V261 Q39,289,11,289' /></svg>");
}

.vector.global > :not(:first-child):not(:empty) {
	background-position: left, var(--global-input-width) center;
}

#toggle-params-menu {
	cursor: pointer;
}

#toggle-params-menu:hover,
#toggle-params-menu:focus {
	text-decoration: underline;
}

#toggle-params-menu:focus h2 {
	background-color: rgba(0, 0, 0, 0.0875);
}

#toggle-params-menu h2::after {
	content: "(+)";
}

body.show-params-menu #toggle-params-menu h2::after {
	content: "(-)";
}

#toggle-params-menu:hover .symbol,
#toggle-params-menu:focus .symbol {
	/* TODO: (see above) */
}

#msd-params-table .hide {
	display: none;
}


/* ---- Show Params Menu --------------------------------------------------- */
#params-menu {
	--params-menu-header-width: 3em;

	position: absolute;
	bottom: 0;
	right: 0;
	z-index: 4; /* On top of everything */
	width: calc(0.5 * var(--params-form-width));
	height: calc(0.65 * var(--params-form-width));
	box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.4);
	background-color: white;
	box-sizing: border-box;

	font-size: 0.9rem;

	transition: transform 1s;
	transform: translateY(100%);
}

body.show-params-menu #params-menu {
	transform: translateY(0);
}

#params-menu > * {
	position: absolute;
	top: 1rem;
	bottom: 1rem;
	left: 0;
	right: 0;
	overflow-y: auto;
	box-sizing: border-box;
	margin-bottom: -1rem;
}

#params-menu section {
	--params-menu-section-border-width: 1px;
	display: flex;
	justify-content: flex-start;
	margin: 0em 1rem 1rem 1rem;
	cursor: pointer;
	box-sizing: border-box;
	border: var(--params-menu-section-border-width) solid transparent;
}

#params-menu section:hover,
#params-menu section:focus {
	border: var(--params-menu-section-border-width) solid black;
}

#params-menu section > * {
	padding: 0.5em 1em;
}

#params-menu section header {
	width: var(--params-menu-header-width);
	background-color: #e6e6e6;
	text-align: center;
	font-weight: bold;
}

#params-menu section .description {
	display: flex;
	justify-content: space-between;
	width: calc(100% - var(--params-menu-header-width));
	background-color: #d0d0d0;
	font: 0.85rem "Open Sans", sans-serif;
}

#params-menu .add {
	margin-left: 1em;
	font-weight: bold;
}

#params-menu section header,
#params-menu section .description > * {
	display: flex;
	flex-direction: column;
	justify-content: center;
}

#params-menu .hide {
	display: none;
}



/* ---- Lens --------------------------------------------------------------- */
#lens {
	position: absolute;
	z-index: 1;
	top: calc(var(--header-height) + 1rem);
	right: 1rem;

	box-sizing: border-box;
	padding: 0.5em 1em;
	border: 0px hidden;
	text-align: center;
}


/* ---- Timeline ----------------------------------------------------------- */
#timeline {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: var(--timeline-height);

	box-sizing: border-box;
	background-color: white;
	border-top: 2px solid black;
	white-space: nowrap;

	transition: transform 1s;
	transform: translateY(100%);
	overflow-x: hidden;
}

body.show-timeline #timeline {
	transform: translateY(0);
	overflow-x: auto;
}

#timeline > * {
	display: inline-block;
	box-sizing: border-box;
	min-width: 3vw;
	min-height: 3vw;
	margin: 0.75vw;
	border: 1px solid black;
	border-radius: 50%;
	font-size: 10pt;
	text-align: center;
	background-color: burlywood;
	font-family: monospace;
	cursor: pointer;
	padding: 1em;
}

#timeline > *:hover {
	filter: brightness(0.7);
	border-color: darkgoldenrod;
}

#timeline > *.active {
	border-color: yellow;
	background-color: aqua;
}

